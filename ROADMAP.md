# Этапы разработки

## Этап 1-2: Инфраструктура

**Цель:** Подготовить окружение для разработки и будущего деплоя.

**Что делаем:**
- Создаём репозиторий (Git)
- Настраиваем Docker-контейнеры (Django + PostgreSQL + Nginx)
- Создаём структуру проекта
- Настраиваем переменные окружения (.env) or env_example

**Результат:** Локальное окружение готово. Можно запускать проект одной командой.

**Срок:** 1 день

---

## Этап 3: База данных

**Цель:** Создать структуру для хранения данных.

**Что делаем:**
- Проектируем модели: Student, Course, Task, Grade
- Пишем миграции Django
- Настраиваем связи между таблицами
- Добавляем индексы для быстрого поиска

**Модели:**

| Модель | Ключевые поля |
|--------|---------------|
| Student | email, telegram_id, name, zenclass_id |
| Course | name, zenclass_id |
| Task | name, course, zenclass_id |
| Grade | student, task, value, comment, checked_at |
(может выглядеть по другому, нужно ориентироваться на нужные нам значения)
**Результат:** База готова принимать данные.

**Срок:** 1 день

---

## Этап 4: Webhooks

**Цель:** Научить сервер принимать данные от ZenClass.

**Что делаем:**
- Создаём endpoint `/webhook`
- Реализуем проверку подписи (sha1)
- Обрабатываем событие `lesson_task_accepted`:
  - Находим студента по email
  - Парсим оценку из комментария
  - Сохраняем в базу
- Обрабатываем `product_user_subscribed` (новая подписка)
- Обрабатываем `access_to_course_expired` (окончание доступа)
- Добавляем защиту от дублей (по webhook ID)

**Результат:** Сервер принимает вебхуки и сохраняет данные.

**Срок:** 2-3 дня

---

## Этап 5: Миграция данных

**Цель:** Загрузить существующих учеников и их историю.

**Что делаем:**
- Подключаемся к Google Sheets API
- Парсим таблицу «Студенты» (email, имя, купленные курсы)
- Парсим таблицы курсов (списки учеников)
- Импортируем данные в нашу базу
- Создаём связи Student ↔ Course

**Результат:** В базе все текущие ученики с их курсами.

**Срок:** 1-2 дня

---

## Этап 6: Авторизация

**Цель:** Связать Telegram-пользователя с профилем ученика.

**Что делаем:**
- Получаем `initData` от Telegram при открытии Mini App
- Проверяем подпись (защита от подделки)
- Если пользователь новый — показываем форму ввода email
- Ищем email в базе, связываем с telegram_id
- Создаём сессию Django

**Результат:** Ученик авторизуется один раз, потом входит автоматически.

**Срок:** 1-2 дня

---

## Этап 7: API

**Цель:** Создать endpoints для Mini App.

**Что делаем:**
- `GET /api/me` — данные текущего пользователя
- `GET /api/courses` — список курсов ученика
- `GET /api/courses/{id}` — задания и оценки по курсу
- `GET /api/stats` — статистика (streak, общий прогресс)

**Результат:** Frontend может получать все нужные данные.

**Срок:** 2 дня

---

## Этап 8: Frontend

**Цель:** Реализовать интерфейс по утверждённому дизайну.

**Что делаем:**
- Доработка React-прототипа до production-версии
- Подключение к API (получение данных)
- Интеграция с Telegram Web App SDK
- Обработка состояний (загрузка, ошибки)
- Финальная адаптивность и полировка

**Результат:** Работающий интерфейс Mini App.

**Срок:** 3-4 дня

---

## Этап 9: Уведомления

**Цель:** Отправлять сообщения ученикам при проверке заданий.

**Что делаем:**
- Создаём Telegram-бота (или используем существующего)
- Интегрируем aiogram
- При получении webhook с оценкой — отправляем сообщение
- Формат: «Твоя работа по курсу [X] проверена. Оценка: [Y]»

**Результат:** Ученики получают уведомления в Telegram.

**Срок:** 1 день

---

## Этап 10: Деплой

**Цель:** Запустить приложение на боевом сервере.

**Что делаем:**
- Арендуем VPS
- Настраиваем домен и SSL-сертификат
- Разворачиваем Docker-контейнеры
- Настраиваем Nginx (проксирование, HTTPS)
- Подключаем базу данных
- Настраиваем автоматизации в ZenClass (прописываем боевой URL)
- Запускаем миграцию данных из Google Sheets

**Результат:** Приложение работает в продакшене.

**Срок:** 1-2 дня

---

## Этап 11: Тестирование и отладка

**Цель:** Убедиться, что всё работает корректно.

**Что делаем:**
- Тестируем авторизацию с реальными email
- Проверяем приём вебхуков (принимаем тестовое задание в ZenClass)
- Проверяем парсинг оценок в разных форматах
- Тестируем уведомления
- Проверяем отображение на разных устройствах
- Исправляем найденные баги

**Результат:** Стабильно работающее приложение.

**Срок:** 2-3 дня

---

## Сводка

| Этап | Что включает | Срок |
|------|--------------|------|
| 1. Дизайн | Прототип интерфейса, согласование с заказчиком | 2-3 дня |
| 2. Инфраструктура | Настройка окружения разработки | 1 день |
| 3. База данных | Структура хранения данных | 1 день |
| 4. Webhooks | Приём данных от ZenClass, парсинг оценок | 2-3 дня |
| 5. Миграция | Импорт учеников и курсов из Google Sheets | 1-2 дня |
| 6. Авторизация | Вход через Telegram, привязка по email | 1-2 дня |
| 7. API | Получение курсов, оценок, статистики | 2 дня |
| 8. Frontend | Интерфейс приложения | 3-4 дня |
| 9. Уведомления | Сообщения в Telegram об оценках | 1 день |
| 10. Деплой | Запуск на сервере | 1-2 дня |
| 11. Тестирование | Проверка сценариев, исправление ошибок | 2-3 дня |
| **Итого** | | **~3 недели** |
