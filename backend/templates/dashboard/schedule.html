{% extends "base.html" %}

{% block title %}Расписание — Кружок{% endblock %}

{% block content %}
<div class="space-y-4" x-data="{ activeMonth: '{% if schedule_by_month %}{{ schedule_by_month.0.key }}{% endif %}' }">

  <!-- Заголовок -->
  <div class="flex items-center justify-between px-1">
    <div>
      <p class="text-[10px] font-semibold text-gray-400 dark:text-slate-500 uppercase tracking-widest mb-1">План курса</p>
      <h1 class="text-xl font-semibold text-brand-dark dark:text-white leading-tight">{{ current_course.name }}</h1>
      {% if schedule %}
      <p class="text-xs text-gray-400 dark:text-slate-500 mt-1.5">
        {{ schedule.first.scheduled_at|date:"j E Y" }} - {{ schedule.last.scheduled_at|date:"j E Y" }}
      </p>
      {% endif %}
    </div>
    <a href="{% url 'dashboard' %}" class="p-2 bg-gray-100 dark:bg-slate-800 rounded-full text-gray-400 dark:text-slate-300 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 6 6 18M6 6l12 12"></path>
      </svg>
    </a>
  </div>

  <!-- Табы по месяцам -->
  {% if schedule_by_month %}
  <div class="overflow-x-auto no-scrollbar -mx-5 px-5">
    <div class="flex items-center gap-2 w-max py-2">
      {% for month in schedule_by_month %}
      <button
        @click="activeMonth = '{{ month.key }}'"
        :class="activeMonth === '{{ month.key }}'
          ? 'bg-brand-dark dark:bg-slate-700 text-white'
          : 'bg-white/70 dark:bg-slate-800/80 text-gray-500 dark:text-slate-400 border border-gray-100 dark:border-slate-700'"
        class="px-3 py-1.5 rounded-full text-[11px] font-semibold whitespace-nowrap transition-colors"
      >
        {{ month.label }}
      </button>
      {% endfor %}
    </div>
  </div>

  <!-- Контент по месяцам -->
  {% for month in schedule_by_month %}
  <div x-show="activeMonth === '{{ month.key }}'" x-transition>
    <div class="mb-3 flex items-center justify-between px-1">
      <p class="text-[11px] font-semibold text-gray-400 dark:text-slate-500 uppercase tracking-wider">Занятий: {{ month.events|length }}</p>
    </div>

    <div class="bg-white/65 dark:bg-slate-800/45 rounded-2xl border border-white/70 dark:border-slate-700/70 overflow-hidden">
      {% for event in month.events %}
      <div class="px-4 py-3 {% if not forloop.last %}border-b border-gray-100 dark:border-slate-700/80{% endif %}">
        <div class="grid grid-cols-[54px_1fr] gap-3">
          <!-- Дата -->
          <div class="rounded-xl bg-white/75 dark:bg-slate-700/70 border border-gray-100 dark:border-slate-600/70 text-center py-2">
            <p class="text-lg font-semibold text-brand-dark dark:text-white leading-none">
              {{ event.scheduled_at|date:"d" }}
            </p>
            <p class="text-[10px] font-semibold text-gray-400 dark:text-slate-400 uppercase tracking-wide mt-1">
              {{ event.scheduled_at|date:"M" }}
            </p>
          </div>

          <!-- Контент -->
          <div class="min-w-0">
            <div class="flex items-start justify-between gap-2">
              <p class="text-sm font-semibold text-brand-dark dark:text-white leading-snug">{{ event.title }}</p>
              <span class="text-[11px] font-semibold whitespace-nowrap
                {% if event.is_past %}text-gray-400 dark:text-slate-500{% elif event.is_today %}text-brand-dark dark:text-white{% else %}text-brand-primary{% endif %}">
                {% if event.is_past %}Прошло{% elif event.is_today %}Сегодня{% else %}Скоро{% endif %}
              </span>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endfor %}

  {% else %}
  <div class="text-center py-12 text-gray-400">
    <p>Расписание пока не заполнено</p>
  </div>
  {% endif %}

</div>
{% endblock %}

{% block nav %}
{% with active='home' %}
{% include "components/nav.html" %}
{% endwith %}
{% endblock %}
